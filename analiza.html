<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Analysis Journal - $225</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a2a 50%, #0f1e3a 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 98%;
            margin: 0 auto;
            padding: 0 10px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px 0;
            border-bottom: 2px solid #ff9500;
        }

        .header h1 {
            font-size: 2.5em;
            background: linear-gradient(90deg, #ff9500, #ff7b00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .header p {
            color: #aaa;
            font-size: 1.1em;
        }

        .nav-buttons {
            text-align: center;
            margin-bottom: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .nav-btn {
            background: linear-gradient(135deg, #ff9500, #ff7b00);
            color: #fff;
            border: none;
            padding: 12px 30px;
            margin: 0;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 149, 0, 0.3);
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 149, 0, 0.5);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, #fff, #e0e0e0);
            color: #000;
        }

        .page {
            display: none;
            animation: fadeIn 0.5s;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-container {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 149, 0, 0.2);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            color: #ff9500;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 0.9em;
        }

        input, select, textarea {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 149, 0, 0.3);
            border-radius: 8px;
            padding: 12px;
            color: #fff;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #ff9500;
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 10px rgba(255, 149, 0, 0.3);
        }

        select option {
            background: #1a1a1a;
            color: #fff;
        }

        textarea {
            resize: vertical;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .save-btn {
            background: linear-gradient(135deg, #ff9500, #ff7b00);
            color: #fff;
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            width: 100%;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 149, 0, 0.3);
        }

        .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 149, 0, 0.5);
        }

        .table-container {
            overflow-x: auto;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 149, 0, 0.2);
            border-radius: 15px;
            padding: 20px;
            max-width: 100%;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85em;
        }

        thead {
            background: linear-gradient(135deg, rgba(255, 149, 0, 0.2), rgba(255, 123, 0, 0.2));
        }

        th {
            padding: 12px 8px;
            text-align: left;
            color: #ff9500;
            font-weight: 600;
            border-bottom: 2px solid #ff9500;
            white-space: nowrap;
        }

        td {
            padding: 10px 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: #ddd;
            font-size: 0.9em;
        }

        tr:hover {
            background: rgba(255, 149, 0, 0.05);
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: #888;
            font-size: 1.1em;
        }

        .edit-btn, .delete-btn {
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
            transition: all 0.3s ease;
            border: none;
            color: #fff;
            margin-right: 5px;
        }

        .edit-btn {
            background: linear-gradient(135deg, #4488ff, #0066cc);
        }

        .delete-btn {
            background: linear-gradient(135deg, #ff4444, #cc0000);
        }

        .edit-btn:hover, .delete-btn:hover {
            transform: scale(1.05);
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .loading-overlay.active {
            display: flex;
        }

        .spinner {
            border: 5px solid rgba(255, 149, 0, 0.2);
            border-top: 5px solid #ff9500;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .analysis-section {
            background: rgba(255, 149, 0, 0.1);
            border: 1px solid rgba(255, 149, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .analysis-section h3 {
            color: #ff9500;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .filter-section {
            background: linear-gradient(135deg, rgba(255, 149, 0, 0.08), rgba(255, 123, 0, 0.03));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 149, 0, 0.25);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div style="display: flex; align-items: center; justify-content: center; gap: 20px; flex-wrap: wrap;">
                <div style="font-size: 4em; line-height: 1;">üìä</div>
                <div style="text-align: center;">
                    <h1>Market Analysis Journal</h1>
                    <p style="margin: 5px 0 0 0; font-size: 1.2em; color: #ff9500; font-weight: 600;">Market Analyst</p>
                    <p style="margin: 3px 0 0 0; font-size: 0.9em;">Track & Review Your Market Analysis</p>
                </div>
            </div>
        </div>

        <div class="nav-buttons">
            <button class="nav-btn active" id="btnList">Analysis History</button>
            <button class="nav-btn" id="btnForm" style="display: none;">Add Analysis</button>
            <button class="nav-btn" id="btnLogin" style="background: linear-gradient(135deg, #00cc88, #00aa72);">üîê Login</button>
            <button class="nav-btn" id="btnLogout" style="display: none; background: linear-gradient(135deg, #ff6b6b, #ee5a6f);">üö™ Logout</button>
        </div>

        <!-- Form Page -->
        <div id="formPage" class="page">
            <div class="form-container">
                <h2 style="margin-bottom: 25px; color: #ff9500;">üìä Add Market Analysis</h2>
                
                <!-- Basic Info -->
                <div class="form-grid">
                    <div class="form-group">
                        <label for="month">Month *</label>
                        <select id="month" required>
                            <option value="">Select</option>
                            <option value="January">January</option>
                            <option value="February">February</option>
                            <option value="March">March</option>
                            <option value="April">April</option>
                            <option value="May">May</option>
                            <option value="June">June</option>
                            <option value="July">July</option>
                            <option value="August">August</option>
                            <option value="September">September</option>
                            <option value="October">October</option>
                            <option value="November">November</option>
                            <option value="December">December</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="day">Day *</label>
                        <select id="day" required>
                            <option value="">Select</option>
                            <option value="Monday">Monday</option>
                            <option value="Tuesday">Tuesday</option>
                            <option value="Wednesday">Wednesday</option>
                            <option value="Thursday">Thursday</option>
                            <option value="Friday">Friday</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="year">Year *</label>
                        <select id="year" required>
                            <option value="">Select</option>
                            <option value="2024">2024</option>
                            <option value="2025">2025</option>
                            <option value="2026">2026</option>
                            <option value="2027">2027</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="pair">Pair *</label>
                        <select id="pair" onchange="handlePairChange()" required>
                            <option value="">Select</option>
                            <option value="EUR/USD">EUR/USD</option>
                            <option value="GBP/USD">GBP/USD</option>
                            <option value="XAU/USD">XAU/USD</option>
                            <option value="USD/JPY">USD/JPY</option>
                            <option value="US100">US100</option>
                            <option value="GER40">GER40</option>
                            <option value="Other">Other...</option>
                        </select>
                    </div>
                    <div class="form-group" id="customPairGroup" style="display: none;">
                        <label for="customPair">Enter Pair</label>
                        <input type="text" id="customPair" placeholder="ex: AUD/USD, BTC/USD">
                    </div>
                </div>

                <!-- Weekly Analysis -->
                <div class="analysis-section">
                    <h3>üìÖ Weekly Analysis</h3>
                    <div class="form-grid">
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label for="weeklyAnalysis">Analysis</label>
                            <textarea id="weeklyAnalysis" rows="4" placeholder="Weekly market overview, key levels, bias..."></textarea>
                        </div>
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label for="weeklyPhoto">Photo Link (Imgur, TradingView, etc.)</label>
                            <input type="url" id="weeklyPhoto" placeholder="https://i.imgur.com/...">
                        </div>
                    </div>
                </div>

                <!-- Daily Analysis -->
                <div class="analysis-section">
                    <h3>üìä Daily Analysis</h3>
                    <div class="form-grid">
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label for="dailyAnalysis">Analysis</label>
                            <textarea id="dailyAnalysis" rows="4" placeholder="Daily zones, supply/demand, daily bias..."></textarea>
                        </div>
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label for="dailyPhoto">Photo Link</label>
                            <input type="url" id="dailyPhoto" placeholder="https://i.imgur.com/...">
                        </div>
                    </div>
                </div>

                <!-- 4H Analysis -->
                <div class="analysis-section">
                    <h3>‚è±Ô∏è 4H Analysis</h3>
                    <div class="form-grid">
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label for="fourHAnalysis">Analysis</label>
                            <textarea id="fourHAnalysis" rows="4" placeholder="4H structure, fractals, entry zones..."></textarea>
                        </div>
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label for="fourHPhoto">Photo Link</label>
                            <input type="url" id="fourHPhoto" placeholder="https://i.imgur.com/...">
                        </div>
                    </div>
                </div>

                <!-- 1H Analysis -->
                <div class="analysis-section">
                    <h3>‚ö° 1H Analysis</h3>
                    <div class="form-grid">
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label for="oneHAnalysis">Analysis</label>
                            <textarea id="oneHAnalysis" rows="4" placeholder="1H entries, liquidity sweeps, timing..."></textarea>
                        </div>
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label for="oneHPhoto">Photo Link</label>
                            <input type="url" id="oneHPhoto" placeholder="https://i.imgur.com/...">
                        </div>
                    </div>
                </div>

                <button class="save-btn" id="saveBtn">üíæ Save Analysis</button>
            </div>
        </div>

        <!-- List Page -->
        <div id="listPage" class="page active">
            <!-- Filters -->
            <div class="filter-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h2 style="color: #ff9500; margin: 0; font-size: 1.5em;">üîç Filters</h2>
                    <button onclick="resetFilters()" style="background: linear-gradient(135deg, #ff6b6b, #ee5a6f); color: #fff; border: none; padding: 12px 28px; border-radius: 25px; cursor: pointer; font-weight: 600;">üîÑ Reset</button>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="filterMonth">üìÖ Month</label>
                        <select id="filterMonth" onchange="applyFilters()">
                            <option value="">All months</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="filterDay">üìÜ Day</label>
                        <select id="filterDay" onchange="applyFilters()">
                            <option value="">All days</option>
                            <option value="Monday">Monday</option>
                            <option value="Tuesday">Tuesday</option>
                            <option value="Wednesday">Wednesday</option>
                            <option value="Thursday">Thursday</option>
                            <option value="Friday">Friday</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="filterYear">üìÖ Year</label>
                        <select id="filterYear" onchange="applyFilters()">
                            <option value="">All years</option>
                            <option value="2024">2024</option>
                            <option value="2025">2025</option>
                            <option value="2026">2026</option>
                            <option value="2027">2027</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="filterPair">üí± Pair</label>
                        <select id="filterPair" onchange="applyFilters()">
                            <option value="">All pairs</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Table -->
            <div class="table-container">
                <h2 style="margin-bottom: 20px; color: #ff9500;">Analysis History</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Month</th>
                            <th>Day</th>
                            <th>Year</th>
                            <th>Pair</th>
                            <th>Weekly Analysis</th>
                            <th>Weekly Photo</th>
                            <th>Daily Analysis</th>
                            <th>Daily Photo</th>
                            <th>4H Analysis</th>
                            <th>4H Photo</th>
                            <th>1H Analysis</th>
                            <th>1H Photo</th>
                            <th>Share</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="analysisBody">
                        <tr>
                            <td colspan="14" class="no-data">Loading analyses...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="loading-overlay" id="loginModal">
        <div style="background: rgba(255, 255, 255, 0.98); padding: 40px; border-radius: 20px; max-width: 400px; width: 90%;">
            <h2 style="color: #ff9500; margin-bottom: 25px; text-align: center;">üîê Login</h2>
            <div style="margin-bottom: 20px;">
                <label style="display: block; color: #333; margin-bottom: 8px; font-weight: 600;">Username</label>
                <input type="text" id="loginUsername" placeholder="Enter username" style="width: 100%; padding: 12px; border: 2px solid #ff9500; border-radius: 8px; color: #333;">
            </div>
            <div style="margin-bottom: 25px;">
                <label style="display: block; color: #333; margin-bottom: 8px; font-weight: 600;">Password</label>
                <input type="password" id="loginPassword" placeholder="Enter password" style="width: 100%; padding: 12px; border: 2px solid #ff9500; border-radius: 8px; color: #333;" onkeypress="if(event.key==='Enter') attemptLogin()">
            </div>
            <div id="loginError" style="color: #ff4444; margin-bottom: 15px; text-align: center; display: none;"></div>
            <div style="display: flex; gap: 10px;">
                <button onclick="attemptLogin()" style="flex: 1; background: linear-gradient(135deg, #00cc88, #00aa72); color: #fff; border: none; padding: 14px; border-radius: 8px; cursor: pointer; font-weight: 600;">Login</button>
                <button onclick="closeLoginModal()" style="flex: 1; background: linear-gradient(135deg, #ff6b6b, #ee5a6f); color: #fff; border: none; padding: 14px; border-radius: 8px; cursor: pointer; font-weight: 600;">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay active" id="loadingOverlay">
        <div style="text-align: center;">
            <div class="spinner"></div>
            <div style="color: #ff9500; font-size: 1.3em; font-weight: bold;">Loading...</div>
        </div>
    </div>

    <script>
const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby545E0z1U_T4y7Obgp7jbkhjEM-nTQ14zccKu3_WhAWI93028iGy3JHPHk9XJvU1_5/exec';

const CREDENTIALS = {
    username: 'calexi07',
    password: '101994acs!'
};

let analyses = [];
let filteredAnalyses = [];
let editingIndex = -1;
let isLoggedIn = false;

// DOM
const formPage = document.getElementById('formPage');
const listPage = document.getElementById('listPage');
const btnForm = document.getElementById('btnForm');
const btnList = document.getElementById('btnList');
const btnLogin = document.getElementById('btnLogin');
const btnLogout = document.getElementById('btnLogout');
const saveBtn = document.getElementById('saveBtn');
const analysisBody = document.getElementById('analysisBody');
const loadingOverlay = document.getElementById('loadingOverlay');

// Show/Hide Loading
function showLoading() {
    loadingOverlay.classList.add('active');
}

function hideLoading() {
    loadingOverlay.classList.remove('active');
}

// Navigation
btnLogin.onclick = () => showLoginModal();
btnLogout.onclick = () => logout();
btnForm.onclick = () => showPage('form');
btnList.onclick = () => {
    showPage('list');
    loadAnalyses();
};

function handlePairChange() {
    const pairSelect = document.getElementById('pair');
    const customPairGroup = document.getElementById('customPairGroup');
    
    if (pairSelect.value === 'Other') {
        customPairGroup.style.display = 'block';
        document.getElementById('customPair').required = true;
    } else {
        customPairGroup.style.display = 'none';
        document.getElementById('customPair').required = false;
        document.getElementById('customPair').value = '';
    }
}

function showPage(page) {
    formPage.classList.toggle('active', page === 'form');
    listPage.classList.toggle('active', page === 'list');
    btnForm.classList.toggle('active', page === 'form');
    btnList.classList.toggle('active', page === 'list');
}

// Login System
function showLoginModal() {
    document.getElementById('loginModal').style.display = 'flex';
    document.getElementById('loginUsername').value = '';
    document.getElementById('loginPassword').value = '';
    document.getElementById('loginError').style.display = 'none';
}

function closeLoginModal() {
    document.getElementById('loginModal').style.display = 'none';
}

function attemptLogin() {
    const username = document.getElementById('loginUsername').value;
    const password = document.getElementById('loginPassword').value;
    
    if (username === CREDENTIALS.username && password === CREDENTIALS.password) {
        isLoggedIn = true;
        localStorage.setItem('analysisAuth', 'true');
        closeLoginModal();
        updateUIForLogin();
        alert('Login successful!');
    } else {
        document.getElementById('loginError').textContent = 'Invalid credentials';
        document.getElementById('loginError').style.display = 'block';
    }
}

function logout() {
    if (confirm('Logout?')) {
        isLoggedIn = false;
        localStorage.removeItem('analysisAuth');
        updateUIForLogin();
        showPage('list');
    }
}

function updateUIForLogin() {
    btnForm.style.display = isLoggedIn ? 'inline-block' : 'none';
    btnLogin.style.display = isLoggedIn ? 'none' : 'inline-block';
    btnLogout.style.display = isLoggedIn ? 'inline-block' : 'none';
    updateTable();
}

function checkAuth() {
    if (localStorage.getItem('analysisAuth') === 'true') {
        isLoggedIn = true;
        updateUIForLogin();
    }
}

// Load Analyses
function loadAnalyses() {
    showLoading();
    fetch(GOOGLE_SCRIPT_URL + '?action=get&sheet=Sheet1')
        .then(r => r.json())
        .then(res => {
            hideLoading();
            if (res.result === 'success') {
                analyses = res.data || [];
                filteredAnalyses = [...analyses];
                populateFilterDropdowns();
                updateTable();
            } else {
                throw new Error(res.message);
            }
        })
        .catch(err => {
            console.error(err);
            hideLoading();
            analysisBody.innerHTML = '<tr><td colspan="14" class="no-data">Loading error</td></tr>';
        });
}

// Filters
function populateFilterDropdowns() {
    const months = [...new Set(analyses.map(a => a.month))].filter(Boolean).sort();
    const monthSelect = document.getElementById('filterMonth');
    monthSelect.innerHTML = '<option value="">All months</option>';
    months.forEach(m => {
        const opt = document.createElement('option');
        opt.value = m;
        opt.textContent = m;
        monthSelect.appendChild(opt);
    });
    
    const pairs = [...new Set(analyses.map(a => a.pair))].filter(Boolean).sort();
    const pairSelect = document.getElementById('filterPair');
    pairSelect.innerHTML = '<option value="">All pairs</option>';
    pairs.forEach(p => {
        const opt = document.createElement('option');
        opt.value = p;
        opt.textContent = p;
        pairSelect.appendChild(opt);
    });
}

function applyFilters() {
    const month = document.getElementById('filterMonth').value;
    const day = document.getElementById('filterDay').value;
    const year = document.getElementById('filterYear').value;
    const pair = document.getElementById('filterPair').value;
    
    filteredAnalyses = analyses.filter(a => {
        if (month && a.month !== month) return false;
        if (day && a.day !== day) return false;
        if (year && a.year !== year) return false;
        if (pair && a.pair !== pair) return false;
        return true;
    });
    
    updateTable();
}

function resetFilters() {
    document.getElementById('filterMonth').value = '';
    document.getElementById('filterDay').value = '';
    document.getElementById('filterYear').value = '';
    document.getElementById('filterPair').value = '';
    filteredAnalyses = [...analyses];
    updateTable();
}

// Table
function updateTable() {
    if (!filteredAnalyses.length) {
        analysisBody.innerHTML = '<tr><td colspan="14" class="no-data">No analyses yet</td></tr>';
        return;
    }
    
    analysisBody.innerHTML = '';
    
    filteredAnalyses.forEach((a, i) => {
        const tr = document.createElement('tr');
        
        const formatPhoto = (url) => {
            if (!url) return '-';
            return `<a href="${url}" target="_blank" style="color: #ff9500; text-decoration: none;">üì∏ View</a>`;
        };
        
        const truncate = (text) => {
            if (!text) return '-';
            return text.length > 50 ? text.substring(0, 47) + '...' : text;
        };
        
        tr.innerHTML = `
            <td>${a.month}</td>
            <td>${a.day}</td>
            <td>${a.year}</td>
            <td>${a.pair}</td>
            <td title="${a.weeklyAnalysis || ''}">${truncate(a.weeklyAnalysis)}</td>
            <td>${formatPhoto(a.weeklyPhoto)}</td>
            <td title="${a.dailyAnalysis || ''}">${truncate(a.dailyAnalysis)}</td>
            <td>${formatPhoto(a.dailyPhoto)}</td>
            <td title="${a.fourHAnalysis || ''}">${truncate(a.fourHAnalysis)}</td>
            <td>${formatPhoto(a.fourHPhoto)}</td>
            <td title="${a.oneHAnalysis || ''}">${truncate(a.oneHAnalysis)}</td>
            <td>${formatPhoto(a.oneHPhoto)}</td>
            <td>
                <button onclick="shareToDiscord(${analyses.indexOf(a)}, event)" style="background: linear-gradient(135deg, #9c27b0, #7b1fa2); color: #fff; border: none; padding: 6px 12px; border-radius: 5px; cursor: pointer; font-size: 0.8em; font-weight: 600; transition: all 0.3s ease;">
                    üìã Share
                </button>
            </td>
            <td>
                ${isLoggedIn ? `
                    <button class="delete-btn" onclick="deleteAnalysis(${analyses.indexOf(a)})">Delete</button>
                    <button class="edit-btn" onclick="editAnalysis(${analyses.indexOf(a)})">Edit</button>
                ` : '-'}
            </td>
        `;
        
        analysisBody.appendChild(tr);
    });
}

// Share to Discord
function shareToDiscord(index, event) {
    const a = analyses[index];
    
    // Format date
    const dateStr = `${a.day}, ${a.month} ${a.year}`;
    
    // Build Discord-formatted template
    let template = `**üìä ${dateStr} - ${a.pair} Analysis**\n\n`;
    
    // Weekly
    if (a.weeklyAnalysis || a.weeklyPhoto) {
        template += `**üìÖ WEEKLY TIMEFRAME**\n`;
        if (a.weeklyAnalysis) {
            template += `${a.weeklyAnalysis}\n`;
        }
        if (a.weeklyPhoto) {
            template += `üì∏ Chart: ${a.weeklyPhoto}\n`;
        }
        template += `\n`;
    }
    
    // Daily
    if (a.dailyAnalysis || a.dailyPhoto) {
        template += `**üìä DAILY TIMEFRAME**\n`;
        if (a.dailyAnalysis) {
            template += `${a.dailyAnalysis}\n`;
        }
        if (a.dailyPhoto) {
            template += `üì∏ Chart: ${a.dailyPhoto}\n`;
        }
        template += `\n`;
    }
    
    // 4H
    if (a.fourHAnalysis || a.fourHPhoto) {
        template += `**‚è±Ô∏è 4H TIMEFRAME**\n`;
        if (a.fourHAnalysis) {
            template += `${a.fourHAnalysis}\n`;
        }
        if (a.fourHPhoto) {
            template += `üì∏ Chart: ${a.fourHPhoto}\n`;
        }
        template += `\n`;
    }
    
    // 1H
    if (a.oneHAnalysis || a.oneHPhoto) {
        template += `**‚ö° 1H TIMEFRAME**\n`;
        if (a.oneHAnalysis) {
            template += `${a.oneHAnalysis}\n`;
        }
        if (a.oneHPhoto) {
            template += `üì∏ Chart: ${a.oneHPhoto}\n`;
        }
    }
    
    // Copy to clipboard
    navigator.clipboard.writeText(template).then(() => {
        // Show success message
        const btn = event.target;
        const originalText = btn.textContent;
        btn.textContent = '‚úÖ Copied!';
        btn.style.background = 'linear-gradient(135deg, #00cc88, #00aa72)';
        
        setTimeout(() => {
            btn.textContent = originalText;
            btn.style.background = 'linear-gradient(135deg, #9c27b0, #7b1fa2)';
        }, 2000);
    }).catch(err => {
        alert('Copy failed! Please try again.');
        console.error(err);
    });
}

// Save
saveBtn.onclick = () => {
    const analysis = getFormData();
    if (!analysis) return;
    
    if (editingIndex >= 0 && analyses[editingIndex]?.id) {
        analysis.id = analyses[editingIndex].id;
        updateAnalysis(analysis);
    } else {
        addAnalysis(analysis);
    }
};

function getFormData() {
    const required = ['month', 'day', 'year', 'pair'];
    for (const id of required) {
        if (!document.getElementById(id).value) {
            alert('Please fill Month, Day, Year, and Pair');
            return null;
        }
    }
    
    // Get pair value (handle "Other" option)
    let pairValue = document.getElementById('pair').value;
    if (pairValue === 'Other') {
        pairValue = document.getElementById('customPair').value;
        if (!pairValue || pairValue.trim() === '') {
            alert('Please enter a custom pair');
            return null;
        }
    }
    
    return {
        month: document.getElementById('month').value,
        day: document.getElementById('day').value,
        year: document.getElementById('year').value,
        pair: pairValue,
        weeklyAnalysis: document.getElementById('weeklyAnalysis').value,
        weeklyPhoto: document.getElementById('weeklyPhoto').value,
        dailyAnalysis: document.getElementById('dailyAnalysis').value,
        dailyPhoto: document.getElementById('dailyPhoto').value,
        fourHAnalysis: document.getElementById('fourHAnalysis').value,
        fourHPhoto: document.getElementById('fourHPhoto').value,
        oneHAnalysis: document.getElementById('oneHAnalysis').value,
        oneHPhoto: document.getElementById('oneHPhoto').value
    };
}

function addAnalysis(analysis) {
    showLoading();
    const qs = new URLSearchParams({ action: 'add', ...analysis });
    fetch(GOOGLE_SCRIPT_URL + '?' + qs)
        .then(() => {
            hideLoading();
            clearForm();
            showPage('list');
            loadAnalyses();
        })
        .catch(err => {
            console.error(err);
            hideLoading();
            alert('Save error');
        });
}

function updateAnalysis(analysis) {
    showLoading();
    const qs = new URLSearchParams({ action: 'update', ...analysis });
    fetch(GOOGLE_SCRIPT_URL + '?' + qs)
        .then(() => {
            hideLoading();
            editingIndex = -1;
            clearForm();
            showPage('list');
            loadAnalyses();
        })
        .catch(err => {
            console.error(err);
            hideLoading();
            alert('Update error');
        });
}

function editAnalysis(i) {
    editingIndex = i;
    const a = analyses[i];
    
    // Handle pair selection (check if it's a predefined pair or custom)
    const predefinedPairs = ['EUR/USD', 'GBP/USD', 'XAU/USD', 'USD/JPY', 'US100', 'GER40'];
    if (predefinedPairs.includes(a.pair)) {
        document.getElementById('pair').value = a.pair;
        document.getElementById('customPairGroup').style.display = 'none';
    } else {
        document.getElementById('pair').value = 'Other';
        document.getElementById('customPair').value = a.pair;
        document.getElementById('customPairGroup').style.display = 'block';
    }
    
    document.getElementById('month').value = a.month || '';
    document.getElementById('day').value = a.day || '';
    document.getElementById('year').value = a.year || '';
    document.getElementById('weeklyAnalysis').value = a.weeklyAnalysis || '';
    document.getElementById('weeklyPhoto').value = a.weeklyPhoto || '';
    document.getElementById('dailyAnalysis').value = a.dailyAnalysis || '';
    document.getElementById('dailyPhoto').value = a.dailyPhoto || '';
    document.getElementById('fourHAnalysis').value = a.fourHAnalysis || '';
    document.getElementById('fourHPhoto').value = a.fourHPhoto || '';
    document.getElementById('oneHAnalysis').value = a.oneHAnalysis || '';
    document.getElementById('oneHPhoto').value = a.oneHPhoto || '';
    
    showPage('form');
}

function deleteAnalysis(i) {
    if (!confirm('Delete this analysis?')) return;
    showLoading();
    fetch(`${GOOGLE_SCRIPT_URL}?action=delete&id=${analyses[i].id}`)
        .then(() => {
            hideLoading();
            loadAnalyses();
        })
        .catch(err => {
            console.error(err);
            hideLoading();
            alert('Delete error');
        });
}

function clearForm() {
    ['month', 'day', 'year', 'pair', 'weeklyAnalysis', 'weeklyPhoto',
     'dailyAnalysis', 'dailyPhoto', 'fourHAnalysis', 'fourHPhoto',
     'oneHAnalysis', 'oneHPhoto'].forEach(id => {
        document.getElementById(id).value = '';
    });
    editingIndex = -1;
}

// Init
window.onload = () => {
    checkAuth();
    loadAnalyses();
};
    </script>
</body>
</html>
